var fs = require('fs');
var rootfolder = process.cwd() + '/config';

function parsePage (path) {
  var page = JSON.parse(fs.readFileSync(path).toString());
  page.absolutePath = path;
  return page;
}

var fill = function(folder, pages) {
  var dirList = fs.readdirSync(folder);
  dirList.forEach(function(item) {
      if (fs.statSync(folder + '/' + item).isDirectory()) {
          fill(folder + '/' + item, pages);
      } else {
          pages.push(parsePage(folder + '/' + item));
      }
  });
};

exports.fill = function(pages) {
  fill(rootfolder + '/pages', pages);
}
exports.write = function(page) {
  page.modified_time = (new Date()).getTime();
  fs.writeFileSync(page.absolutePath, JSON.stringify(page));
}
