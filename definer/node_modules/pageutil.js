var fs = require('fs');
var pathUtil = require('path');
var pagefolder = process.cwd() + pathUtil.sep + 'config' + pathUtil.sep + 'pages';

function parsePage (path) {
  var page = JSON.parse(fs.readFileSync(path).toString());
  page.path = pathUtil.basename(path);
  return page;
}

var fill = function(folder, pages) {
  var dirList = fs.readdirSync(folder);
  dirList.forEach(function(item) {
      if (fs.statSync(folder + pathUtil.sep + item).isDirectory()) {
          fill(folder + pathUtil.sep + item, pages);
      } else {
          pages.push(parsePage(folder + pathUtil.sep + item));
      }
  });
};

exports.fill = function(pages) {
  fill(pagefolder, pages);
}
exports.write = function(page) {
  fs.writeFileSync(pagefolder + pathUtil.sep +page.path, JSON.stringify(page));
}
exports.remove = function(page) {
  fs.unlink(pagefolder + pathUtil.sep +page.path);
}
