var fs = require('fs');
var pathUtil = require('path');
var appfolder = process.cwd() + pathUtil.sep + 'config' + pathUtil.sep + 'apps';

function parseApp (path) {
  var app = JSON.parse(fs.readFileSync(path).toString());
  app.path = pathUtil.basename(path);
  return app;
}

var fill = function(folder, apps) {
  var dirList = fs.readdirSync(folder);
  dirList.forEach(function(item) {
      if (fs.statSync(folder + pathUtil.sep + item).isDirectory()) {
          fill(folder + pathUtil.sep + item, apps);
      } else {
          apps.push(parseApp(folder + pathUtil.sep + item));
      }
  });
};

exports.init = function() {
  if (fs.existsSync(appfolder)) { return; }
  fs.mkdirSync(appfolder);
}
exports.fill = function(apps) {
  fill(appfolder, apps);
}
exports.write = function(app) {
  var pagesPath = appfolder + pathUtil.sep + app.id;
  if (fs.existsSync(pagesPath)) { return; }
  fs.mkdirSync(pagesPath);
  fs.writeFileSync(appfolder + pathUtil.sep + app.idã€€+ pathUtil.sep + app.id + ".json", JSON.stringify(app));
}
exports.remove = function(app) {
  fs.unlink(appfolder + pathUtil.sep +app.path);
}
